name: Update brew formula
on:
  repository_dispatch:
    types: [update]

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Get Latest Release
        id: latest_version
        uses: abatilo/release-info-action@v1.1.0
        with:
          owner: cloudwaste
          repo: cloudwaste
      - name: Update formula
        env:
          LATEST: ${{ steps.latest_version.outputs.latest_tag }}
        run: |
          version=`echo "$LATEST" | cut -c2-`
          ./update.sh cloudwaste $version
      - name: Create PR
        uses: peter-evans/create-pull-request@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'feat: Update cloudwaste formula to ${{ steps.latest_version.outputs.latest_tag }}'
          title: 'feat: Update cloudwaste formula to ${{ steps.latest_version.outputs.latest_tag }}'
          body: |
            Autogenerated PR to update to latest release of cloudwaste: ${{ steps.latest_version.outputs.latest_tag }}
